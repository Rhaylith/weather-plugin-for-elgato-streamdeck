<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title>com.tarikguney.weather</title>
    <link rel="stylesheet" href="sdpi.css">
    <script src="common.js"></script>
</head>

<body>
<div class="sdpi-wrapper">
    <div class="sdpi-item">
        <div class="sdpi-item-label">Zip Code</div>
        <input class="sdpi-item-value" id="zipCode" required onblur="zipCode=event.target.value">

    </div>
    <div class="sdpi-item">
        <div class="sdpi-item-label">AccuWeather API Key</div>
        <input class="sdpi-item-value" id="apiKey" required onblur="apiKey=event.target.value">
    </div>
    <div class="sdpi-item">
        <div class="sdpi-item-label">About the API Key</div>
        <details class="sdpi-item-value">
            <p>Unfortunately, AccuWeather allows 50 requests per day to the their forecast API for free accounts. Therefore, you should get your own API Key. It is easy. Just create a new account and visit <a href="https://developer.accuweather.com/user/me/apps">https://developer.accuweather.com/user/me/apps</a> to get your API key by adding a new application.eam</p>
        </details>
    </div>
    <div class="sdpi-item">
        <button class="sdpi-item-value" id="saveButton" onclick="sendToPlugin()">Save</button>
    </div>
</div>

<script>
    let uuid = '',
        zipCode = "",
        apiKey = "",
        actionName = "";

    if ($SD) {
        $SD.on('connected', function (jsonObj) {
            uuid = jsonObj['uuid'];
            if (jsonObj.hasOwnProperty('actionInfo')) {
                actionName = jsonObj.actionInfo.action;
            }
            let settings = $SD.actionInfo.payload.settings;
            if (settings.zipCode) {
                document.getElementById("zipCode").value = settings.zipCode;
            }
            if (settings.apiKey) {
                document.getElementById("apiKey").value = settings.apiKey;
            }
        });
    }

    function sendToPlugin() {
        if (zipCode && apiKey) {
            if ($SD && $SD.connection) {
                let payload = {};
                payload.zipCode = zipCode;
                payload.apiKey = apiKey;
                $SD.api.sendToPlugin(uuid, actionName, payload);
            }
        }

    }

</script>

</body>

</html>
